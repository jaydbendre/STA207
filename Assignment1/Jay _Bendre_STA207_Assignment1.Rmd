---
title: "STA 207: Assignment I"
author: "Jay Bendre, 920211348"
output: html_document
---


A consulting firm is investigating the relationship between wages and occupation. The file `Wage.csv` contains three columns, which are 

  - `wage`, the wage of the subject,
  - `ethnicity`, the ethnicity of the subject,
  - and `occupation`, the occupation of the subject. 
  
We will only use `wage` and `occupation` in this assignment. 

***

```{r,echo=T,results=F,message=F, warning=FALSE}
Wage=read.csv('Wage.csv');
library(gplots)
library(dplyr)
library(ggplot2)
library(car)
library(stats)
attach(Wage)
```


Getting a preview into the dataset.
```{r}
Wage <- Wage %>% select(c("wage","occupation"))

Wage$occupation <- as.factor(Wage$occupation)
Wage %>% head()

levels_occupation <- levels(Wage$occupation)
levels_occupation
```

*** 

(1) Write down a one-way ANOVA model for this data. For consistency, choose the letters from $\{Y,\alpha, \mu, \epsilon\}$ and use the factor-effect form. 

The one-way anova model can be represented as:
$$
Y_{ij} = \mu + \alpha_{i} + \epsilon_{ij}
$$

where, 

1. $Y_{ij} =$ Wage (Response variable)

2. $\alpha_i = \mu_{i} - \mu$ (Sample Mean - Population Mean)

3. $i = \{`r levels_occupation`\}$

4. $j = 1 .. `r length(Wage$wage)`$ (Number of rows)

5. $\epsilon_{ij} =$ Error terms.

***

(2)  Write down the least squares estimator of $\alpha_i$ for all $i$. Find the expectation and variance of this estimate in terms of $\{n_i\}$ and the parameters of the model. 

The least squares estimator for $\alpha_i$ is given by:

$$
\hat{\alpha_{i}} = \bar{Y_{i}} - \hat{\mu}
$$

where, 

1. $\hat{\mu} = \sum_{i=1}^{6} w_{i}\bar{Y_{i}}$

2. $w_{i} = \frac{n_i}{n_T}$

3. $n_{i} =$ Population Size in the $i^{th}$ level of the occupation factor

4. $n_{T} =$ Total Population size.


Expectation of $\hat{\alpha_{i}}$

$$
E[\hat{\alpha_{i}}] = E[\bar{Y_i} - \hat{\mu}] = E[\bar{Y_{i}}] - E[\hat{\mu}] = \mu_i - E[\hat{\mu}]
$$

$$
E[\hat{\mu}] = E[\sum_{i = 1} ^{r} w_i \bar{Y_i}] = \sum_{i = 1} ^{r} w_i E[\bar{Y_i}] = \sum_{i = 1} ^{r} w_i \mu_i = \mu
$$

Therefore,

$$E[\hat{\alpha_{i}}] = \mu_i - \mu$$


Variance of $\hat{\alpha_{i}}$

$$
var(\hat{\alpha_{i}}) = var(\bar{Y_i}) + var(\hat{\mu}) - 2 cov(\bar{Y_i},\hat{\mu_i})
$$

$$
var(\bar{Y_{i}}) = var(\frac{1}{n_i} \sum_{j=1}^{n_i} Y_{ij}) = \frac{1}{n_i^2} \sum_{j=1}^{n_i} var(Y_{ij}) = \frac{1}{n_i^2} * {n_i}  * \sigma^2 = \frac{\sigma^2}{n_i}
$$

$$
var(\hat{\mu}) = var(\sum_{i=1}^{r} w_i \bar{Y_i}) = var(\sum_{i=1}^{r} \frac{n_i}{n_T} * \frac{1}{n_i} \sum_{j=1}^{n_i}Y_{ij}) = \frac{1}{n_T^2} var(\sum_{i=1}^{r}\sum_{j=1}^{n_i} Y_{ij}) = \frac{1}{n_T^2} \sum_{i=1}^{r}\sum_{j=1}^{n_i} var(Y_{ij})
$$

$$
 = \frac{1}{n_T^2} * \sigma^2 \sum_{i=1}^{r}\sum_{j=1}^{n_i} 1 = \frac{1}{n_T^2} * \sigma^2 * n_{T} = \frac{\sigma^2}{n_T}
$$

$$
cov(\bar{Y_i},\hat{\mu}) = cov(\bar{Y_i}, \sum_{i=1}^{r} \omega_i \bar{Y_i}) = cov(\bar{Y_i},\omega_1\bar{Y_1} + \omega_2\bar{Y_2} .... + \omega_i\bar{Y_i} + .... \omega_r\bar{Y_r})
$$

Since the groups are independent of each other, 
$$
cov(\bar{Y_i},\bar{Y_j}) = 0, i\neq j
$$
which implies
$$
cov(\bar{Y_i},\hat{\mu}) = \omega_icov(\bar{Y_i},\bar{Y_i}) = \omega_i var(\bar{Y_i}) = \frac{n_i}{n_T} * \frac{\sigma^2}{n_i} = \frac{\sigma^2}{n_T}
$$

Therefore,

$$
var(\hat{\alpha_i}) = \sigma^2 (\frac{1}{n_i} + \frac{1}{n_T} - \frac{2}{n_T}) = \sigma^2(\frac{1}{n_i} - \frac{1}{n_T})
$$

*** 

(3) Obtain the main effects plots. Summarize your findings.
```{r}
plotmeans(wage ~ occupation, xlab = "Occupation", ylab = "Wage", data = Wage, main =  "Main effect plot", connect = FALSE)
```

Seeing the graphs we can see that the specific occupation is responsible for changing the mean salary. Occupations in __management__ seem to have significantly higher wages as opposed to occupations in __services__. Occupations in __technical__ seem to have the second highest wages after management.

*** 

(4) Set up the ANOVA table using `R` for your model. Briefly explain this table.   

```{r}
anova_model <- aov(wage ~ as.factor(occupation), data = Wage)
summary(anova_model)
```

Looking at the p-value of the above model we can conclude that there is a statistical difference between all the occupations. By this we can say that occupation does affect the salaries in some way - having a positive or negative effect as opposed to the population mean.

*** 

(5) Test whether there is any association between `occupation` and `wage`. In particular, you need to (a) define the null and alternative hypotheses using the notation in Part 1, (b) conduct the test, and (c) explain your test result. 

We can perform hypothesis testing by checking whether all the mean of wages are equal for all occupation.

(a)

Null Hypothesis $H_0: \mu_{management} = \mu_{technical} = ..... \mu_{services}$

Alternate Hypothesis $H_a:$ Not all $\mu_{i}$ are the same.

Let significance level = $\alpha = 0.05$

The testing condition in this case is defined as: We can reject the null hypothesis if at given significance level $\alpha$ ,  

$$
F^* > F(1-\alpha, r-1,n_T-r)
$$

In the given problem, $r = 6$ and $n_T = 534$

(b)

We conduct a F-test to check for the above hypothesis. The F statistic is defined as: 

$$
F^* = \frac{MSTR}{MSE} = \frac{\frac{SSTR}{r-1}}{\frac{SSE}{n_T-r}}
$$
From the ANOVA table we have,

$MSTR = 507.5$ & $MSE = 21.9$

Therefore, $F^* = `r 507.5/21.9`$

The critical value of the F-test = $F(1-0.05,6-1,534 - 6)$ = $`r qf(1-0.05,5,534-6)`$


(c)

Since the value of $F^*$ > $F(1-0.05, 5, 528)$, we reject the null hypothesis and can conclude that the averages across various occupations are different to each other. Thus we can say that there is some influence of the occupation on the average wages.

*** 

(6) For the model fitted in Part 4, carry out the necessary diagnostics to check if the model assumptions given in Part 1 are valid. What are your findings?

```{r}
par(mfrow = c(2,2))
plot(anova_model)
```

From the above plots, we can conclude the following: 

* Observing the residuals vs fitted plot, we can see that the errors seem to have a constant variance. 

* On seeing the QQ-plot, we see a slight right skew in the data. 

* There dont seem to be any outliers or high leverage points.

```{r}
residuals = anova_model$residuals

hist(residuals)
stem(residuals)
```
Levenes Test for equal variances

$H_0: \alpha_{management} = \alpha_{technical} = ..... = \alpha_{worker}$

$H_a: \alpha_i \neq \alpha_j$ where $i \neq j$

```{r}
leveneTest(wage ~ as.factor(occupation), data = Wage)

```

Seeing this we see that the P- value obtained is significantly less than the $\alpha = 0.05$ so we can reject the null hypothesis and conclude that variances are not equal across all the groups. 

Shapiro - Wilke Test for normality
```{r}
shapiro.test(residuals)
```

Since the P-value is significantly less than $\alpha = 0.05$, we can conclude that the residuals are not normally distributed. 

*** 
	
(7) Assuming that the assumptions you made are true, can you statistically conclude if there is one occupation where the mean wage is the highest? Use the most appropriate method (use $\alpha=0.05$) to support your statement.

In order to check we can perform the Tukey Test. Following is the setup for the Tukey Test.

Tukey test is a single-step multiple comparison procedure and statistical test. It is a post-hoc analysis, what means that it is used in conjunction with an ANOVA.

It allows to find means of a factor that are significantly different from each other, comparing all possible pairs of means with a t-test like method. 

```{r}
TukeyHSD(x = anova_model, conf.level = 0.95)

```

In order to determine whether mean of a group is greater than the mean of other group, all possible differences need to be statistically significant. 

In this case lets consider __management__ with all other groups. We can see that the difference is statistically significant except in the case of __technical - management __ . Similarly its possible  to find such a combination for all groups hence we can conclude that no one mean is significantly greater than other means. 


*** 

## Acknowledgement {-}
Collaborated with team mates assigned in the roster to solve the assignment. 


Citing all the possible resources used while performing the experiment

1. Tukey Test: https://www.r-graph-gallery.com/84-tukey-test.html

2. Levene Test : https://datasharkie.com/how-to-do-levene-test-in-r/

## Session information {-}
```{r}
sessionInfo()
```